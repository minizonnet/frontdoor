{% extends "base.html" %}
{% block subtitle %}Sign in with Keystone credentials to reach your cloud console{% endblock %}

{% block card %}
  <div class="topline">
    <div class="pill">{{ brand_name }}</div>
    <div class="pill">Keystone v3 â€¢ Password</div>
  </div>

  {# 
    If there's an error (wrong creds / captcha), show it prominently in red.
    If there's also a warning (tries left / captcha next), show it INSIDE the error box as a smaller line.
    This guarantees "Invalid credentials" is visible on every failure.
  #}
  {% if error %}
    <div class="alert alert-danger">
      <div class="alertTitle">{{ error }}</div>
      {% if warning %}
        <div class="alertSub">{{ warning }}</div>
      {% endif %}
    </div>
  {% else %}
    {# No error, but we may still have warnings (e.g., lockout countdown) #}
    {% if warning %}
      <div class="alert alert-{{ warning_class }}">{{ warning }}</div>
    {% endif %}
  {% endif %}

  <form method="post" autocomplete="on">
    <div class="row">
      <label>Username</label>
      <input name="username" autocomplete="username" required>
    </div>

    <div class="row">
      <label>Password</label>
      <input name="password" type="password" autocomplete="current-password" required>
    </div>

    {% if captcha_required %}
      <div class="row">
        <label>Captcha</label>
        <div class="captchaBox">
          <div class="captchaQ">{{ captcha_question }}</div>
          <input name="captcha" inputmode="numeric" placeholder="Answer" required>
        </div>
      </div>
    {% endif %}

    <div class="row">
      <button class="btn" type="submit">Sign in</button>
    </div>
  </form>

  <div class="muted">
    This validates Keystone credentials and opens the portal. It does not create an SSO session in Horizon yet.
  </div>
{% endblock %}

